<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Time Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f0f4f8;
    color: #222;
  }
  h1, h2 {
    margin-bottom: 10px;
  }
  .container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  .box {
    background: white;
    padding: 15px;
    border-radius: 6px;
    box-shadow: 0 0 8px #ccc;
    min-width: 280px;
    flex: 1;
  }
  button {
    margin: 5px 5px 5px 0;
    padding: 8px 14px;
    font-size: 14px;
    cursor: pointer;
  }
  input[type=text] {
    padding: 6px 10px;
    font-size: 14px;
    width: 180px;
    margin-right: 8px;
  }
  select {
    padding: 6px 10px;
    font-size: 14px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 6px 10px;
    text-align: left;
  }
  th {
    background: #eee;
  }
</style>
</head>
<body>

<h1>Simple Time Tracker</h1>

<div>
  <label>
    Efficiency:
    <select id="efficiencySelect">
      <option value="full">Full Efficiency</option>
      <option value="half">Half Efficiency</option>
    </select>
  </label>
</div>

<div class="container">
  <div class="box">
    <h2>Timer</h2>
    <div id="timerDisplay" style="font-size: 2em;">00:00:00</div>
    <button id="timerStartBtn">Start</button>
    <button id="timerPauseBtn">Pause</button>
    <button id="timerResetBtn">Reset</button>
  </div>

  <div class="box">
    <h2>Stopwatch</h2>
    <div id="stopwatchDisplay" style="font-size: 2em;">00:00:00</div>
    <button id="stopwatchStartBtn">Start</button>
    <button id="stopwatchPauseBtn">Pause</button>
    <button id="stopwatchResetBtn">Reset</button>
  </div>

  <div class="box">
    <h2>Projects</h2>
    <input type="text" id="projectInput" placeholder="New project name" />
    <button id="addProjectBtn">Add Project</button>
    <div id="projectsList" style="margin-top: 10px;"></div>
  </div>
</div>

<div class="box" style="margin-top: 20px;">
  <h2>Daily Summary (<span id="todayDate"></span>)</h2>
  <div>Total Time Invested: <span id="totalMinutes">0</span> minutes</div>
  <div>Target Today: <span id="dailyTarget">240</span> minutes</div>
  <table>
    <thead>
      <tr><th>Project</th><th>Minutes</th></tr>
    </thead>
    <tbody id="dailyProjectTimesBody"></tbody>
  </table>
</div>

<script>
(() => {
  const STORAGE_KEY = 'timeTrackerSimpleData';

  function formatSecondsToHMS(sec) {
    const h = Math.floor(sec/3600);
    const m = Math.floor((sec%3600)/60);
    const s = Math.floor(sec%60);
    return [h,m,s].map(n => n.toString().padStart(2,'0')).join(':');
  }

  function getToday() {
    return new Date().toISOString().slice(0,10);
  }

  function dayOfWeekNum() {
    return new Date().getDay(); // 0=Sun ... 6=Sat
  }

  // Load saved data or initialize
  let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  if (!data.projects) data.projects = [];
  if (!data.dailyRecords) data.dailyRecords = {};
  if (!data.timerSeconds) data.timerSeconds = 0;
  if (!data.stopwatchSeconds) data.stopwatchSeconds = 0;
  if (!data.selectedProject) data.selectedProject = null;
  if (!data.efficiency) data.efficiency = 'full';
  if (!data.lastSavedDate) data.lastSavedDate = getToday();

  const today = getToday();

  // Reset timer and stopwatch if date changed
  if (data.lastSavedDate !== today) {
    data.timerSeconds = 0;
    data.stopwatchSeconds = 0;
    if (!data.dailyRecords[today]) data.dailyRecords[today] = {};
    data.lastSavedDate = today;
  }

  // Determine daily target
  function getDailyTarget() {
    const day = dayOfWeekNum();
    if (day >= 1 && day <= 4) return 240; // Mon-Thu
    if (day === 5) return 180; // Fri
    return 0; // Sat, Sun
  }

  // UI refs
  const todayDateEl = document.getElementById('todayDate');
  const dailyTargetEl = document.getElementById('dailyTarget');
  const totalMinutesEl = document.getElementById('totalMinutes');
  const dailyProjectTimesBody = document.getElementById('dailyProjectTimesBody');
  const projectsListEl = document.getElementById('projectsList');
  const efficiencySelect = document.getElementById('efficiencySelect');

  todayDateEl.textContent = today;
  dailyTargetEl.textContent = getDailyTarget();
  efficiencySelect.value = data.efficiency;

  // Save data
  function save() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  // Render projects list
  function renderProjects() {
    projectsListEl.innerHTML = '';
    if (data.projects.length === 0) {
      projectsListEl.textContent = 'No projects yet.';
      return;
    }
    data.projects.forEach(p => {
      const btn = document.createElement('button');
      btn.textContent = p + (data.selectedProject === p ? ' âœ“' : '');
      btn.onclick = () => {
        data.selectedProject = p;
        renderProjects();
        save();
      };
      projectsListEl.appendChild(btn);
    });
  }

  // Render daily project times
  function renderDailyTimes() {
    dailyProjectTimesBody.innerHTML = '';
    let total = 0;
    if (data.dailyRecords[today]) {
      for (const [proj, mins] of Object.entries(data.dailyRecords[today])) {
        total += mins;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${proj}</td><td>${Math.round(mins)}</td>`;
        dailyProjectTimesBody.appendChild(tr);
      }
    }
    totalMinutesEl.textContent = Math.round(total);
  }

  // Add time to selected project and update daily records
  function addMinutes(minutes) {
    if (!data.selectedProject) return;
    if (!data.dailyRecords[today]) data.dailyRecords[today] = {};
    if (!data.dailyRecords[today][data.selectedProject]) data.dailyRecords[today][data.selectedProject] = 0;
    data.dailyRecords[today][data.selectedProject] += minutes;
  }

  // Timer logic
  const timerDisplay = document.getElementById('timerDisplay');
  let timerInterval = null;

  function updateTimerDisplay() {
    timerDisplay.textContent = formatSecondsToHMS(data.timerSeconds);
  }

  function timerTick() {
    const eff = data.efficiency === 'full' ? 1 : 0.5;
    data.timerSeconds += eff;
    addMinutes(eff / 60);
    updateTimerDisplay();
    renderDailyTimes();
    save();
  }

  document.getElementById('timerStartBtn').onclick = () => {
    if (timerInterval) return;
    timerInterval = setInterval(timerTick, 1000);
  };
  document.getElementById('timerPauseBtn').onclick = () => {
    clearInterval(timerInterval);
    timerInterval = null;
  };
  document.getElementById('timerResetBtn').onclick = () => {
    clearInterval(timerInterval);
    timerInterval = null;
    data.timerSeconds = 0;
    updateTimerDisplay();
    save();
  };

  updateTimerDisplay();

  // Stopwatch logic
  const stopwatchDisplay = document.getElementById('stopwatchDisplay');
  let stopwatchInterval = null;

  function updateStopwatchDisplay() {
    stopwatchDisplay.textContent = formatSecondsToHMS(data.stopwatchSeconds);
  }

  function stopwatchTick() {
    const eff = data.efficiency === 'full' ? 1 : 0.5;
    data.stopwatchSeconds += eff;
    addMinutes(eff / 60);
    updateStopwatchDisplay();
    renderDailyTimes();
    save();
  }

  document.getElementById('stopwatchStartBtn').onclick = () => {
    if (stopwatchInterval) return;
    stopwatchInterval = setInterval(stopwatchTick, 1000);
  };
  document.getElementById('stopwatchPauseBtn').onclick = () => {
    clearInterval(stopwatchInterval);
    stopwatchInterval = null;
  };
  document.getElementById('stopwatchResetBtn').onclick = () => {
    clearInterval(stopwatchInterval);
    stopwatchInterval = null;
    data.stopwatchSeconds = 0;
    updateStopwatchDisplay();
    save();
  };

  updateStopwatchDisplay();

  // Add project button
  document.getElementById('addProjectBtn').onclick = () => {
    const val = document.getElementById('projectInput').value.trim();
    if (!val) {
      alert('Please enter a project name');
      return;
    }
    if (data.projects.includes(val)) {
      alert('Project already exists');
      return;
    }
    data.projects.push(val);
    data.selectedProject = val;
    document.getElementById('projectInput').value = '';
    renderProjects();
    save();
  };

  // Efficiency change
  efficiencySelect.onchange = () => {
    data.efficiency = efficiencySelect.value;
    save();
  };

  // Initial renders
  renderProjects();
  renderDailyTimes();

})();
</script>

</body>
</html>
